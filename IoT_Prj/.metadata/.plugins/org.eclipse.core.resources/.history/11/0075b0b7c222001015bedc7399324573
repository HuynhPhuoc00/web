/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 ******************************************************************************
 * @attention
 *
 * Copyright (c) 2023 STMicroelectronics.
 * All rights reserved.
 *
 * This software is licensed under terms that can be found in the LICENSE file
 * in the root directory of this software component.
 * If no LICENSE file comes with this software, it is provided AS-IS.
 *
 ******************************************************************************
 */

#include "stm32f411.h"

// Enable GPIO for I2C
void En_GPIO(){
	GPIOB_PCLK_EN;
	// Enable port PB8
	GPIO_Handle_t PB8;
	PB8.pGPIOx = GPIOB;
	PB8.GPIO_Pin_Config_t.GPIO_PinNumber = GPIO_PIN_NUM_8;
	PB8.GPIO_Pin_Config_t.GPIO_PinMode = GPIO_MODER_ALTFM;
	PB8.GPIO_Pin_Config_t.GPIO_PinOPType = GPIO_OTYPER_OD;
	PB8.GPIO_Pin_Config_t.GPIO_PinSpeed = GPIO_OSPEEDR_VERYHIGH;
	PB8.GPIO_Pin_Config_t.GPIO_PinPuPdControl = GPIO_PUPDR_PU;
	PB8.GPIO_Pin_Config_t.GPIO_PinAltFunMode = GPIO_AFRH_AF4;
	GPIO_Init(&PB8);

	// Enable port PB9
	GPIO_Handle_t PB9;
	PB9.pGPIOx = GPIOB;
	PB9.GPIO_Pin_Config_t.GPIO_PinNumber = GPIO_PIN_NUM_9;
	PB9.GPIO_Pin_Config_t.GPIO_PinMode = GPIO_MODER_ALTFM;
	PB9.GPIO_Pin_Config_t.GPIO_PinOPType = GPIO_OTYPER_OD;
	PB9.GPIO_Pin_Config_t.GPIO_PinSpeed = GPIO_OSPEEDR_VERYHIGH;
	PB9.GPIO_Pin_Config_t.GPIO_PinPuPdControl = GPIO_PUPDR_PU;
	PB9.GPIO_Pin_Config_t.GPIO_PinAltFunMode = GPIO_AFRH_AF4;
	GPIO_Init(&PB9);
}


// Function for test I2C
void Test_I2C(){
//	I2C1_PLCK_EN;
//	En_GPIO();
//	I2C_Handle_t I2CHandle;
//	I2CHandle.pI2Cx = I2C1;
//	I2CHandle.I2C_Congif_t.I2C_DeviceAddr = 0xD0;
//	I2CHandle.I2C_Congif_t.I2C_AckControl = 0x1;
//	I2CHandle.I2C_Congif_t.I2C_SCLSpeed = I2C_SCL_SPEED_SM;
//	I2C_Init(&I2CHandle);
//	uint8_t  pTxbuffer[2];
//	pTxbuffer[0] = 0x11111111;
//	pTxbuffer[1] = 0x22222222;
//	pTxbuffer[2] = 0x33333333;
//	I2C_MasterSendData(&I2CHandle, pTxbuffer, 0x32);
//	I2C1_PLCK_DIS;
	I2C_Config();
	I2C_Start();
	I2C_Address(0xD0);
}

int main(void)
{
	// Test I2C
	printf ("Testing ...");
	Test_I2C();
}
